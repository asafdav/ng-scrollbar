/**
 * ng-scrollbar
 * @version v0.0.8 - 2016-05-08
 * @link https://github.com/asafdav/ng-scrollbar
 * @author Asaf David <asafdav@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("ngScrollbar",[]).directive("ngScrollbar",["$parse","$window",function(a,b){return{restrict:"A",replace:!0,transclude:!0,scope:{showYScrollbar:"=?isBarShown"},link:function(a,c,d){var e,g,h,i,j,k,l,m,n,o,p,q={bottom:d.hasOwnProperty("bottom")},r=angular.element(b),s=!!r[0].addEventListener,t=!!r[0].removeEventListener,u={top:0},v={top:0},w=function(){l={position:"relative",overflow:"hidden","max-width":"100%",height:"100%"},v.height&&(l.height=v.height+"px"),m={position:"absolute",height:u.height+"px",top:u.top+"px"},n={position:"relative","line-height":u.height+"px"},o={position:"relative",top:v.top+"px",overflow:"hidden"}},x=function(b){i.css("top",u.top+"px");var c=u.top/v.height;v.top=-Math.round(v.scrollHeight*c),g.css("top",v.top+"px"),b&&a.$emit("scrollbar.scroll",{top:top})},y=function(b){var c=u.top!==b;u.top=b,c&&u.top+u.height==u.trackHeight&&a.$emit("scrollbar.bottom")},z=function(a){var b=a.hasOwnProperty("offsetY")?a.offsetY:a.layerY,c=Math.max(0,Math.min(parseInt(u.trackHeight,10)-parseInt(u.height,10),b));y(c),x(),a.stopPropagation()},A=function(a){var b=40,c=a,d=c.detail,e=c.wheelDelta,g=225,h=g-1;return d=d?e&&(f=e/d)?d/f:-d/1.35:e/120,d=1>d?-1>d?(-Math.pow(d,2)-h)/g:d:(Math.pow(d,2)+h)/g,a.delta=Math.min(Math.max(d/2,-1),1),a.delta=a.delta*b,y(Math.max(0,Math.min(parseInt(v.height,10)-parseInt(u.height,10),parseInt(u.top,10)-a.delta))),x(!0),a.preventDefault?void a.preventDefault():!1},B=0,C=function(a,b,c){y(Math.max(0,Math.min(parseInt(u.trackHeight,10)-parseInt(u.height,10),c))),a.stopPropagation()},D=function(a){var b=0,c=a.pageY-i[0].scrollTop-B;C(a,b,c),x(!0)},E=function(a){r.off("mousemove",D),r.off("mouseup",E),a.stopPropagation()},F=function(a){var b=0,c=a.originalEvent.changedTouches[0].pageY-i[0].scrollTop-B;C(a,b,c),x(!0)},G=function(a){r.off("touchmove",F),r.off("touchend",G),a.stopPropagation()},H=function(a){var b=void 0!==r[0].onmousewheel?"mousewheel":"DOMMouseScroll";s?a.addEventListener(b,A,!1):a.attachEvent("onmousewheel",A)},I=function(a){var b=void 0!==r[0].onmousewheel?"mousewheel":"DOMMouseScroll";t?a.removeEventListener(b,A,!1):a.detachEvent("onmousewheel",A)},J=function(b,d){b=q.bottom||b,e=angular.element(c.children()[0]),g=angular.element(e.children()[0]),h=angular.element(e.children()[1]),i=angular.element(angular.element(h.children()[0]).children()[0]),j=angular.element(i.children()[0]),k=angular.element(angular.element(h.children()[0]).children()[1]),v.height=c[0].offsetHeight,v.scrollHeight=g[0].scrollHeight,v.height<v.scrollHeight?(a.showYScrollbar=!0,a.$emit("scrollbar.show"),u.height=Math.round(v.height/v.scrollHeight*v.height),u.trackHeight=v.height,w(),c.css({overflow:"hidden"}),e.css(l),g.css(o),i.css(m),j.css(n),k.bind("click",z),H(g[0]),i.on("mousedown",function(a){B=a.pageY-i[0].offsetTop,r.on("mouseup",E),r.on("mousemove",D),a.preventDefault()}),i.on("touchstart",function(a){B=a.originalEvent.changedTouches[0].pageY-i[0].offsetTop,r.on("touchend",G),r.on("touchmove",F),a.preventDefault()}),b?(q.bottom=!1,u.top=parseInt(v.height,10)-parseInt(u.height,10)):u.top=Math.max(0,Math.min(parseInt(v.height,10)-parseInt(u.height,10),parseInt(u.top,10))),d&&(u.top-=1),x()):(a.showYScrollbar=!1,a.$emit("scrollbar.hide"),i.off("mousedown"),I(g[0]),g.attr("style","position:relative;top:0"),e.css({height:"100%"}))},K=function(b,c){null!=p&&clearTimeout(p);var d=!!c&&!!c.rollToBottom,e=!!c&&!!c.ensureCanScroll;p=setTimeout(function(){v.height=null,J(d,e),a.$$phase||a.$digest(),a.$parent.$$phase||a.$parent.$digest()},72)};J(),d.rebuildOn&&d.rebuildOn.split(" ").forEach(function(b){a.$on(b,K)}),d.hasOwnProperty("rebuildOnResize")&&r.on("resize",K)},template:'<div><div class="ngsb-wrap"><div class="ngsb-container" ng-transclude></div><div class="ngsb-scrollbar" style="position: absolute; display: block;" ng-show="showYScrollbar"><div class="ngsb-thumb-container"><div class="ngsb-thumb-pos" oncontextmenu="return false;"><div class="ngsb-thumb" ></div></div><div class="ngsb-track"></div></div></div></div></div>'}}]);